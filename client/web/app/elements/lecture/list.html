<dom-module id="lectures-list">
    <style>
        paper-fab.add-lecture {
            z-index: 20;
            position: absolute;
            bottom: -30px;
            right: 30px;
            height: 60px;
            width: 60px;
            --paper-fab-background: #13E4FF;
        }
        paper-dropdown-menu.custom {
            --paper-input-container-label: {
                color: white;
            }
            --paper-input-container-input: {
                color: white;
                font-style: normal;
            }
            paper-input-container-underline: {
                display: none;
            }
        }
        .presentation-list-card {
            margin-top: 0px;
            margin-bottom: 0px;
        }
    </style>
    <template>

    <iron-meta id="meta"></iron-meta>
    <iron-signals on-iron-signal-auth="_authStateChange"></iron-signals>

  <paper-header-panel condenses keep-condensed-header>
    <paper-toolbar class="primary-toolbar additional-toolbar">
          <paper-dropdown-menu label="Category" class="custom">
            <paper-menu class="dropdown-content" on-iron-select="_categorySelectedFromDropdown" selected="{{selectedCategory}}" attr-for-selected="dataValue">
                <template is="dom-repeat" items="[[config.categories]]">
                    <paper-item data-value="{{item}}" class="capitalize">{{item}}</paper-item>
                </template>
            </paper-menu>
          </paper-dropdown-menu>
          <template is="dom-if" if="{{isSigned}}">
            <paper-fab icon="add" title="Add" class="bottom add-lecture" on-tap="addLecture"></paper-fab>
          </template>
    </paper-toolbar>
    <div class="page-content">
        <div class="layout vertical">
            <template is="dom-repeat" items="[[categories]]">
                <template is="dom-if" if="{{item.show}}")>
                    <paper-material elevation="1" class="card-default presentation-list-card" style="width: 100%;">
                        <lectures-list-by-category category="{{item.name}}" show-more="{{item.showMore}}" on-category-selected="_categorySelected"></lectures-list-by-category>
                    </paper-material>
                </template>
            </template>
      </div>
    </div>
  </paper-header-panel>

    </template>
    <script>
        Polymer({
            is: 'lectures-list',
            properties: {
                config: Object,
                isSigned: Boolean,
                selectedCategory: String,
                categories: Object
            },
            ready: function() {
                this.set('config', Config);
                this.categories = Config.categories.filter(function(item) {
                    return item !== 'all';
                }).map(function (item) {
                    return {
                        name: item,
                        show: true,
                        showMore: false
                    };
                });
            },
            _authStateChange: function(e, data) {
                this.set('isSigned', data.isSigned);
            },
            addLecture: function() {
                page('/lecture/add');
            },
            _categorySelectedFromDropdown: function(e, data) {
                this._categorySelected(e, data.item.dataValue);
            },
            _categorySelected: function(e, data) {
                this.set('selectedCategory', data);
                for (var i = 0; i < this.categories.length; i++) {
                    if (this.selectedCategory === 'all') {
                        this.set('categories.' + i + '.show', true);
                        this.set('categories.' + i + '.showMore', false);
                    } else {
                        var isSelected = this.categories[i].name === this.selectedCategory;
                        this.set('categories.' + i + '.show', isSelected);
                        this.set('categories.' + i + '.showMore', isSelected);
                    }
                }
            }
        });
    </script>
</dom-module>
